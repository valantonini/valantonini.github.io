<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="A blog about all things programming by val antonini.">
    <title>Graphs and pathing in C#</title>
    <link rel="canonical" href="http://arakawa.asia/2013/08/04">
    <!-- Custom CSS -->

    <link rel="icon" href="http://arakawa.asia/images/favicon.png">

    <!--<script src="http://arakawa.asia/bower_components/jquery/dist/jquery.min.js"></script>-->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>if (!window.jQuery) {
    var localjQuery = 'http://arakawa.asia/bower_components/jquery/dist/jquery.min.js';
    var localjQueryScript = '<script src="'+localjQuery+'"><\/script>';
    document.write(localjQueryScript);
}
</script>
    <!-- website by valantonini -->
     <!--Background pattern from subtlepatterns.com -->
</head>


<body>
<div class="arakawa-bg">
    <div class="container">
        <nav class="navbar navbar-default navbar-static-top/Users/val/Downloads/paper_fibers/paper_fibers.png">
    <div class="container">

        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://arakawa.asia">
                <img src="http://arakawa.asia/images/logo.png" alt="arakawa icon" class="logo">
                arakawa.asia
            </a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        Posts<span class="caret"></span>
                    </a>
                    <ul class="dropdown-menu" role="menu">
                        <li><a href="http://arakawa.asia/posts/" title="all posts">All Posts</a></li>
                        <li><a href="http://arakawa.asia/categories/" title="categories">Categories</a></li>
                        <li><a href="http://arakawa.asia/tags/" title="tags">Tags</a></li>
                        <li><a href="http://arakawa.asia/search/" title="search">Search</a></li>
                    </ul>
                </li>
                <li>
                    <a href="http://arakawa.asia/about" title="About Me">About</a>
                </li>
                <li>
                    <a href="http://arakawa.asia/contact" title="Contact Me">Contact</a>
                </li>
            </ul>
        </div>

    </div>
</nav>

        <div class="content">
            <div class="row">
                <div class="col-md-12">
                    <div class="post">

    <header>
        <h1>Graphs and pathing in C#</h1>

        <p class="meta">
            Aug 4, 2013 • val antonini
        </p>
    </header>

    <article>
        <p>
<strong>UPDATE 2: This article is now out of date. Please visit <a href="http://arakawa.asia/2014/12/22" title="Graphs and Pathing in C# – part 2">Graphs and Pathing in C# – part 2</a></strong>
</p>
<p>
UPDATE: There was a good article that I enjoyed at <a href="http://www.developingthefuture.net/dijkstra-algorithm-graph-shortest-path/" title="developing the future" target="_blank">developing the future</a> recently that also looks at Dijkstra's algorithm.
</p>

<p>
I am currently working on a game (in Unity3d) with my friends. It's an isometric dungeon crawler similar to Diablo for android. We are planning to release it as a free game just so we can get a feel of the whole process of developing a game, using the tools and getting it into the Play store.
</p>

<p>
One of the decisions we made was to have a dynamic level generator. There are many good resources on dynamic level generation such as <a href="http://donjon.bin.sh/fantasy/dungeon/about/" title="donjon dungeon generator" target="_blank">donjon's</a> but I wanted to try and see what kind of approach I'd come up with by myself (knowing very well it would probably be a far from perfect solution).
</p>

<p>
My approach was to create a bunch of rooms in a 2D matrix and join them together. The generating and placing of random rooms was easy but I was struggling on how I would join them together. I thought back to my studies in Japan where I had the pleasure of taking "Data and Algorithm Structure" under one of my favorite teachers of all time <a href="http://cleo.ci.seikei.ac.jp/~atsuko/index.html">Ikegami Atsuko (池上敦子)</a>. She has won a series of awards for her papers on pathing and scheduling and is a fantastic teacher. I remembered a lesson in which she presented Dijkstra's algorithm for shortest paths and decided to opt for that.
</p>

<p>
I thought I'd use Dijkstra's algorithm to join the 2 center co-ordinates of the room. This is probably a heavy weight approach requiring the whole graph to be generated before the calculating could begin but would guarantee the optimal path (we don't want the player spending all the time in corridors) and ensure the corridor would choose the optimal [N/S/E/W] door to exit/enter without having to determine all the paths between the 2 rooms walls.
</p>

<p>
The first thing I did was to read the dungeon matrix into a graph only to find that C# didn't have a built in graph collection. A quick google shows there are many trade offs to consider when developing a graph and these trade offs are all specific to what the graph is going to be used for. While I am sure there are plenty of graph libraries already out there that would suit my purpose I decided I would build my own to see how it would all piece together. I used <a href="http://msdn.microsoft.com/en-us/library/ms379574(v=vs.80).aspx" target="_blank">this</a> as a launch pad and proceeded to simplify it and take advantage of some of C#'s new features.
</p>

<p>
The result (and purpose of this post) is a C# graph library with shortest path algorithm that I'd like to share with the world (and also my first Github project). You can get it <a href="https://github.com/valantonini/GraphCollection" title="github/valantonini/graphcollection" target="_blank">here at github</a>.
</p>

<p>
Just a quick note, if your wondering why I keep a list of unvisited nodes AND keep a visited boolean on the GraphNode (see below) and proceed to update them both, it's because of the cost of traversing the list to find if a node's neighbor has been visited. This was causing the algorithm to grind to a halt (I was able to get pathing on a Galaxy S3 from 27 seconds to 2.5 seconds by doing this and some other minor tweaks). Also, it may seem like a GraphNode should not be responsible for carrying the distance value used in Dijkstra's algorithm (not to be confused with the edge cost between 2 nodes) but this would once again mean I would not need to perform a lookup when checking for the current distance of a node.
</p>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Dijkstra</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">...</span>

    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GraphNode</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;&gt;</span> <span class="n">_unvisited</span><span class="p">;</span>

    <span class="p">...</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">MarkAsVisited</span><span class="p">(</span><span class="n">GraphNode</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">node</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">node</span><span class="p">.</span><span class="n">Visited</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">_unvisited</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">...</span>

<span class="p">}</span></code></pre></div>

<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">GraphNode</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="n">T</span> <span class="n">Value</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Distance</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">Visited</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="p">...</span>

<span class="p">}</span></code></pre></div>
    </article>

    <div class="tags">
        <span>Tags:</span>
        


        <span class="tag">
            <a href="http://arakawa.asia/tag/csharp

">
    C#
</a>
        </span>
        


        <span class="tag">
            <a href="http://arakawa.asia/tag/game%20development

">
    Game Development
</a>
        </span>
        


        <span class="tag">
            <a href="http://arakawa.asia/tag/pathing

">
    Pathing
</a>
        </span>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'arakawa'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    

</div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <a href="http://arakawa.asia/feed.xml" title="rss" target="_blank"><img src="http://arakawa.asia/images/rss.png" alt="rss icon" class="icon"></a>
<a href="https://www.github.com/valantonini" title="github" target="_blank"><img src="http://arakawa.asia/images/github.png" alt="github icon" class="icon"></a>
<a href="http://arakawa.asia" title="home"><img src="http://arakawa.asia/images/logo.png" alt="arakawa icon" class="icon"></a>


    </footer>
</div>
<!--<link rel="stylesheet" href="http://arakawa.asia/css/main.css">-->
<link rel="stylesheet" href="http://arakawa.asia/css/site.css">
<script src="http://arakawa.asia/bower_components/bootstrap-sass-official/assets/javascripts/bootstrap.js"></script>
<script src="http://arakawa.asia/bower_components/simple-jekyll-search/dest/jekyll-search.js"></script>
<script src="http://arakawa.asia/js/site.js"></script>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-42499658-1', 'auto');
    ga('send', 'pageview');
</script>

</body>
</html>